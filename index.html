<!DOCTYPE html>
<html lang="en">
<head>
  <title>Tea Shops I Recommend</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="title-container">
  <h1>Recommended Loose-Leaf Tea Shops</h1>
  <p class="subtitle">
    Great places nearby to browse and buy some good loose-leaf tea!
  </p>
</div>

<div id="map"></div>

<!-- Mobile-only toggle (visibility handled in CSS) -->
<button id="view-toggle">Online Shops</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-providers@1.13.0/leaflet-providers.js"></script>
<script src="data.js"></script>

<script>
  // -----------------------------
  // Map initialization
  // -----------------------------
  const map = L.map("map").setView([47.6062, -122.3321], 12);

  L.tileLayer.provider("CartoDB.Positron").addTo(map);

  const teaIcon = L.icon({
  iconUrl: "Webmap Tea Pin (Tea Club Logo) v1.png",

  iconSize:     [28, 39], // width, height (adjust to your PNG)
  iconAnchor:   [14, 40], // point of the icon which corresponds to marker location
  popupAnchor:  [0, -36]  // where popups open relative to the icon
});


  // Separate online-only shops
  const onlineShops = teaShops.filter(shop => !shop.coords);

  // -----------------------------
  // Online shops panel (Leaflet control)
  // -----------------------------
  let onlinePanelEl = null;

  const onlineShopControl = L.control({ position: "bottomleft" });

  onlineShopControl.onAdd = function () {
    const container = L.DomUtil.create("div", "online-shops-panel");

    // Save reference for later toggle logic
    onlinePanelEl = container;

    // Prevent map interaction while scrolling panel
    L.DomEvent.disableClickPropagation(container);
    L.DomEvent.disableScrollPropagation(container);

    container.innerHTML = `
      <div class="online-shops-header">Online-Only Shops</div>
      <div class="online-shops-list">
        ${onlineShops.map(shop => `
          <div class="shop-card">
            <div class="shop-name"><b>${shop.name}</b></div>
            <div class="shop-specialty"><strong>Specialty:</strong> ${shop.specialty}</div>
            <div class="shop-city">Location: ${shop.city}</div>
            <div class="shop-recommendation">${shop.recommendation}</div>
            <div class="shop-links">
              <a href="${shop.website}" target="_blank" rel="noopener">
                Website
              </a>
            </div>
          </div>
        `).join("")}
      </div>
    `;

    return container;
  };

  onlineShopControl.addTo(map);

  // -----------------------------
  // Map markers (walk-in shops)
  // -----------------------------
  teaShops.forEach(shop => {
    if (!shop.coords) return;

    const popupContent = `
      <div class="popup">
        <div class="popup-title"><b>${shop.name}</b></div>

        <div class="popup-specialty">
          <strong>Specialty:</strong> ${shop.specialty}
        </div>

        <div class="popup-recommendation">
          ${shop.recommendation}
        </div>

        <div class="popup-links">
          <a href="${shop.website}" target="_blank" rel="noopener">
            Website
          </a>
          <span>Â·</span>
          <a href="${shop.google_maps}" target="_blank" rel="noopener">
            Google Maps
          </a>
        </div>
      </div>
    `;

    L.marker(shop.coords, { icon: teaIcon })
      .addTo(map)
      .bindPopup(popupContent, { closeButton: false });
  });

  // -----------------------------
  // Mobile toggle behavior
  // -----------------------------
  let showingList = false;
  const toggleBtn = document.getElementById("view-toggle");
  const mapEl = document.getElementById("map");

  toggleBtn.addEventListener("click", () => {
    // Only toggle on small screens
    if (window.innerWidth > 768) return;

    showingList = !showingList;

    mapEl.style.display = showingList ? "none" : "block";
    onlinePanelEl.style.display = showingList ? "block" : "block";

    toggleBtn.textContent = showingList ? "Map View" : "Online Shops";

    if (!showingList) {
      map.invalidateSize();
    }
  });
</script>

</body>
</html>
