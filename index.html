<!DOCTYPE html>
<html lang="en">
<head>
  <title>Tea Shops I Recommend</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="title-container">
  <h1>Recommended Loose-Leaf Tea Shops</h1>
  <p class="subtitle">
    Great places nearby to browse and buy some good loose-leaf tea!
  </p>
</div>

<div id="map"></div>

<!-- ✅ Mobile-only online shops container (NOT Leaflet) -->
<div id="mobile-online-shops">
  <div class="online-shops-header">Online-Only Shops</div>
  <div class="online-shops-list" id="mobile-online-list"></div>
</div>

<!-- Mobile-only toggle (hidden via CSS on desktop) -->
<button id="view-toggle">Online Shops</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-providers@1.13.0/leaflet-providers.js"></script>
<script src="data.js"></script>

<script>
  // -----------------------------
  // Map initialization
  // -----------------------------
  const map = L.map("map").setView([47.6062, -122.3321], 12);
  L.tileLayer.provider("CartoDB.Positron").addTo(map);

  const teaIcon = L.icon({
    iconUrl: "Webmap Tea Pin (Tea Club Logo) v1.png",
    iconSize: [28, 39],
    iconAnchor: [14, 40],
    popupAnchor: [0, -36]
  });

  // -----------------------------
  // Separate online-only shops
  // -----------------------------
  const onlineShops = teaShops.filter(shop => !shop.coords);

  // -----------------------------
  // Shared renderer (desktop + mobile)
  // -----------------------------
  function renderOnlineShops(targetEl) {
    targetEl.innerHTML = onlineShops.map(shop => `
      <div class="shop-card">
        <div class="shop-name"><b>${shop.name}</b></div>
        <div class="shop-specialty"><strong>Specialty:</strong> ${shop.specialty}</div>
        <div class="shop-city">Location: ${shop.city}</div>
        <div class="shop-recommendation">${shop.recommendation}</div>
        <div class="shop-links">
          <a href="${shop.website}" target="_blank" rel="noopener">Website</a>
        </div>
      </div>
    `).join("");
  }

  // -----------------------------
  // Desktop: Leaflet control
  // -----------------------------
  const onlineShopControl = L.control({ position: "bottomleft" });

  onlineShopControl.onAdd = function () {
    const container = L.DomUtil.create("div", "online-shops-panel");

    L.DomEvent.disableClickPropagation(container);
    L.DomEvent.disableScrollPropagation(container);

    container.innerHTML = `
      <div class="online-shops-header">Online-Only Shops</div>
      <div class="online-shops-list"></div>
    `;

    renderOnlineShops(container.querySelector(".online-shops-list"));
    return container;
  };

  onlineShopControl.addTo(map);

  // -----------------------------
  // Mobile: standalone list
  // -----------------------------
  renderOnlineShops(document.getElementById("mobile-online-list"));

  // -----------------------------
  // Map markers (walk-in shops)
  // -----------------------------
  teaShops.forEach(shop => {
    if (!shop.coords) return;

    const popupContent = `
      <div class="popup">
        <div class="popup-title"><b>${shop.name}</b></div>
        <div class="popup-specialty">
          <strong>Specialty:</strong> ${shop.specialty}
        </div>
        <div class="popup-recommendation">${shop.recommendation}</div>
        <div class="popup-links">
          <a href="${shop.website}" target="_blank" rel="noopener">Website</a>
          <span>·</span>
          <a href="${shop.google_maps}" target="_blank" rel="noopener">Google Maps</a>
        </div>
      </div>
    `;

    L.marker(shop.coords, { icon: teaIcon })
      .addTo(map)
      .bindPopup(popupContent, { closeButton: false });
  });

  // -----------------------------
  // Mobile toggle behavior
  // -----------------------------
  const toggleBtn = document.getElementById("view-toggle");
  const mapEl = document.getElementById("map");
  const titleEl = document.getElementById("title-container");
  const mobileListEl = document.getElementById("mobile-online-shops");

  let showingList = false;

  toggleBtn.addEventListener("click", () => {
    // Only toggle on small screens
    if (window.innerWidth > 768) return;

    showingList = !showingList;

    mapEl.style.display = showingList ? "none" : "block";
    mobileListEl.style.display = showingList ? "block" : "none";
    titleEl.style.display = showingList ? "none" : "block";

    toggleBtn.textContent = showingList ? "Map View" : "Online Shops";

    if (!showingList) {
      setTimeout(() => map.invalidateSize(), 150);
    }
  });
</script>

</body>
</html>
